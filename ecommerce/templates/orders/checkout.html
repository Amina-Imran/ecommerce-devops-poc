{% extends 'base.html' %} {% block title %}Checkout - BookStore{% endblock %} {% block content %}
<div class="container">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-5 fw-bold text-center mb-3">Checkout</h1>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb justify-content-center">
          <li class="breadcrumb-item">
            <a href="/" class="text-decoration-none">Home</a>
          </li>
          <li class="breadcrumb-item">
            <a href="{% url 'orders:cart' %}" class="text-decoration-none"
              >Cart</a
            >
          </li>
          <li class="breadcrumb-item active" aria-current="page">Checkout</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="row mb-5">
    <div class="col-12">
      <div class="progress" style="height: 4px">
        <div
          class="progress-bar bg-success"
          role="progressbar"
          style="width: 75%"
          aria-valuenow="75"
          aria-valuemin="0"
          aria-valuemax="100"
        ></div>
      </div>
      <div class="d-flex justify-content-between mt-2">
        <small class="text-muted">Cart</small>
        <small class="text-success fw-semibold">Checkout</small>
        <small class="text-muted">Confirmation</small>
      </div>
    </div>
  </div>

  <div class="row justify-content-center">
    <!-- Checkout Form -->
    <div class="col-lg-8 col-md-10">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h4 class="mb-0 fw-semibold">
            <i class="fas fa-user-circle me-2 text-primary"></i>
            Billing Information
          </h4>
        </div>
        <div class="card-body p-4">
          <form
            method="post"
            action="{% url 'orders:checkout' %}"
            id="checkoutForm"
          >
            {% csrf_token %}

            <!-- Name Field -->
            <div class="mb-4">
              <label for="name" class="form-label fw-semibold">
                Full Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control form-control-lg"
                id="name"
                name="name"
                required
              />
            </div>

            <!-- Email Field -->
            <div class="mb-4">
              <label for="email" class="form-label fw-semibold">
                Email Address <span class="text-danger">*</span>
              </label>
              <input
                type="email"
                class="form-control form-control-lg"
                id="email"
                name="email"
                required
              />
            </div>

            <!-- Address Field -->
            <div class="mb-4">
              <label for="address" class="form-label fw-semibold">
                Shipping Address <span class="text-danger">*</span>
              </label>
              <textarea
                class="form-control form-control-lg"
                id="address"
                name="address"
                rows="4"
                required
              ></textarea>
            </div>

            <!-- Phone Number (Optional) -->
            <div class="mb-4">
              <label for="phone" class="form-label fw-semibold"
                >Phone Number</label
              >
              <input
                type="tel"
                class="form-control form-control-lg"
                id="phone"
                name="phone"
              />
            </div>

            <!-- Payment Method -->
            <!-- Payment Method -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Payment Method</label>
              <div class="card bg-light p-3">
                <!-- Cash on Delivery -->
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="payment_method"
                    id="cash_on_delivery"
                    value="cod"
                    checked
                    onclick="toggleCardFields(false)"
                  />
                  <label
                    class="form-check-label fw-semibold"
                    for="cash_on_delivery"
                  >
                    <i class="fas fa-money-bill-wave me-2 text-success"></i>
                    Cash on Delivery
                  </label>
                </div>

                <!-- Card Payment -->
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="payment_method"
                    id="card_payment"
                    value="card"
                    onclick="toggleCardFields(true)"
                  />
                  <label
                    class="form-check-label fw-semibold"
                    for="card_payment"
                  >
                    <i class="fas fa-credit-card me-2 text-primary"></i>
                    Pay with Card
                  </label>
                </div>

                <!-- Card Details (hidden unless card selected) -->
                <div id="card_fields" class="mt-3" style="display: none">
                  <div class="mb-3">
                    <label for="card_number" class="form-label"
                      >Card Number</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="card_number"
                      name="card_number"
                      placeholder="1234 5678 9012 3456"
                    />
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="expiry_date" class="form-label"
                        >Expiry Date</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="expiry_date"
                        name="expiry_date"
                        placeholder="MM/YY"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="cvv" class="form-label">CVV</label>
                      <input
                        type="password"
                        class="form-control"
                        id="cvv"
                        name="cvv"
                        placeholder="123"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="mb-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="terms"
                  name="terms"
                  required
                />
                <label class="form-check-label" for="terms">
                  I agree to the
                  <a href="#" class="text-primary">Terms and Conditions</a>
                </label>
              </div>
            </div>

            <!-- Place Order Button -->
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-success btn-lg py-3">
                <i class="fas fa-check-circle me-2"></i>
                Place Order
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Order Summary Sidebar -->
    <div class="col-lg-4 col-md-10 mt-4 mt-lg-0">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h5 class="mb-0 fw-semibold">
            <i class="fas fa-shopping-bag me-2 text-primary"></i>
            Order Summary
          </h5>
        </div>
        <div class="card-body">
          {% if cart_items %} {% for item in cart_items %}
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <h6 class="mb-0">{{ item.product.name }}</h6>
              <small class="text-muted">Qty: {{ item.quantity }}</small>
            </div>
            <span class="fw-semibold"
              >${{ item.total_price|floatformat:2 }}</span
            >
          </div>
          {% endfor %}
          <hr class="my-3" />
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <span class="fw-semibold">${{ cart_total|floatformat:2 }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping:</span>
            <span class="text-success">Free</span>
          </div>
          <div class="d-flex justify-content-between mb-3">
            <span>Tax:</span>
            <span>${{ cart_tax|floatformat:2 }}</span>
          </div>
          <hr class="my-3" />
          <div class="d-flex justify-content-between">
            <strong>Total:</strong>
            <strong class="text-success fs-5"
              >${{ cart_grand_total|floatformat:2 }}</strong
            >
          </div>
          {% else %}
          <p class="text-muted">Your cart is empty.</p>
          {% endif %}
        </div>
      </div>

      <!-- Return to Cart -->
      <div class="mt-3">
        <a
          href="{% url 'orders:cart' %}"
          class="btn btn-outline-secondary w-100"
        >
          <i class="fas fa-arrow-left me-2"></i>
          Return to Cart
        </a>
      </div>
    </div>
  </div>
</div>

<script>
function toggleCardFields(show) {
    document.getElementById("card_fields").style.display = show ? "block" : "none";
}
</script>
{% endblock %}


