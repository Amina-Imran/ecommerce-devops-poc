{% extends 'base.html' %}

{% block title %}Available Books - BookStore{% endblock %}

{% block content %}
<div class="container">
  <!-- Page Title -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="text-center mb-4">Available Books</h1>
    </div>
  </div>

  <!-- Books Grid -->
  <div class="row">
    {% for book in books %}
    <div class="col-lg-3 col-md-6 col-sm-12 mb-4">
      <div class="card h-100 shadow-sm">
        <!-- Book Image -->
        <img
          src="https://picsum.photos/300/200?random={{ forloop.counter }}"
          class="card-img-top"
          alt="{{ book.title }}"
          style="height: 200px; object-fit: cover"
        />

        <!-- Card Body -->
        <div class="card-body d-flex flex-column">
          <!-- Book Title -->
          <h5 class="card-title">{{ book.title }}</h5>

          <!-- Book Price -->
          <p class="card-text text-success fw-bold fs-5">${{ book.price }}</p>

          <!-- Add to Cart Button -->
          <div class="mt-auto">
            {% if user.is_authenticated %}
              <!-- Logged in: Add to Cart -->
              <a href="{% url 'orders:add_to_cart' book.id %}" class="btn btn-primary w-100">
                <i class="fas fa-cart-plus me-2"></i>Add to Cart
              </a>
            {% else %}
              <!-- Not logged in: Redirect to Login -->
              <a href="{% url 'login' %}?next={% url 'orders:add_to_cart' book.id %}" class="btn btn-warning w-100">
                <i class="fas fa-sign-in-alt me-2"></i>Login to Add
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <!-- No books message -->
    <div class="col-12">
      <div class="alert alert-info text-center" role="alert">
        <h4 class="alert-heading">No Books Available</h4>
        <p>Sorry, there are no books available at the moment. Please check back later!</p>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Demo Books Section (only shown if DB is empty) -->
  {% if not books %}
  <div class="row">
    <div class="col-lg-3 col-md-6 col-sm-12 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="https://picsum.photos/300/200?random=1" class="card-img-top" alt="Book Cover"
             style="height: 200px; object-fit: cover" />
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">The Great Gatsby</h5>
          <p class="card-text text-success fw-bold fs-5">$12.99</p>
          <div class="mt-auto">
            <a href="{% url 'login' %}?next=/orders/add/1/" class="btn btn-warning w-100">
              <i class="fas fa-sign-in-alt me-2"></i>Login to Add
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 col-sm-12 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="https://picsum.photos/300/200?random=2" class="card-img-top" alt="Book Cover"
             style="height: 200px; object-fit: cover" />
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">To Kill a Mockingbird</h5>
          <p class="card-text text-success fw-bold fs-5">$14.50</p>
          <div class="mt-auto">
            <a href="{% url 'login' %}?next=/orders/add/2/" class="btn btn-warning w-100">
              <i class="fas fa-sign-in-alt me-2"></i>Login to Add
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 col-sm-12 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="https://picsum.photos/300/200?random=3" class="card-img-top" alt="Book Cover"
             style="height: 200px; object-fit: cover" />
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">Pride and Prejudice</h5>
          <p class="card-text text-success fw-bold fs-5">$11.25</p>
          <div class="mt-auto">
            <a href="{% url 'login' %}?next=/orders/add/3/" class="btn btn-warning w-100">
              <i class="fas fa-sign-in-alt me-2"></i>Login to Add
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 col-sm-12 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="https://picsum.photos/300/200?random=4" class="card-img-top" alt="Book Cover"
             style="height: 200px; object-fit: cover" />
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">1984</h5>
          <p class="card-text text-success fw-bold fs-5">$13.75</p>
          <div class="mt-auto">
            <a href="{% url 'login' %}?next=/orders/add/4/" class="btn btn-warning w-100">
              <i class="fas fa-sign-in-alt me-2"></i>Login to Add
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
